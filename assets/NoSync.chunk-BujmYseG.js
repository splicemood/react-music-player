import{r as s,j as o,T as Te}from"./index-De7HcTjz.js";import{u as ke,f as n,d as Ee,L as l,a as H,t as Le,s as L,o as Ie,P as je,b as Ae,c as Me,p as Ne,e as Ve,g as we,h as De,i as Re,S as G,B as Be,H as He,j as Ue,C as Oe,r as Qe,l as _e,m as qe,n as ze,T as Ke}from"./Layout-mdUM6-__.js";const m=window.localStorage,$e=({children:I})=>{var F;const[f,P]=ke(void 0,Ae),[a,T]=s.useState([]),[j,p]=s.useState([]),[A,M]=s.useState(""),[c,d]=s.useState(n),[i,u]=s.useState(!1),[g,N]=s.useState(n),[V,U]=s.useState(0),O=m.getItem("player-volume"),J=O?Number(O):Me,[v,W]=s.useState(J),[X,Y]=s.useState(Ee),[Z,k]=s.useState(n),[ee,te]=s.useState(n),se=m.getItem("player-muted")==="true",[x,w]=s.useState(se),re=m.getItem("player-shuffle")==="true",[h,D]=s.useState(re),ne=m.getItem("player-repeat"),[R,ae]=s.useState(Number(ne)||l.PlayAll),[Q,C]=s.useState([]),t=s.useRef(new Audio);s.useEffect(()=>{i&&C(h?e=>[c,...e]:[]),m.setItem("player-shuffle",String(h))},[h]),s.useEffect(()=>{const e=Math.round(v*100);Y(e)},[v]),s.useEffect(()=>{t.current!==null&&(t.current.currentTime=V,N(V))},[V]),s.useEffect(()=>{if(t.current&&a.length>n){const e=a[c];t.current.src=e==null?void 0:e.src,t.current.currentTime=n}},[a,c]),s.useEffect(()=>{t.current&&a.length>n&&(i?(P(!0),t.current.play().then(()=>{P(void 0)}).catch(()=>{P(void 0)})):t.current.pause())},[c,a,i]),s.useEffect(()=>{t.current&&(t.current.volume=v,t.current.muted=x)},[v,x]);const ue=e=>{const r=Array(e.length).fill(0);if(p(r),e.length>0){const y=e.map(S=>S.src);H(y).then(S=>{Array.isArray(S)&&p(S)})}},oe=e=>{H([e.src]).then(r=>{r&&p(y=>[...y,r[0]])})};s.useEffect(()=>{if(a.length>0){const e=a.map(r=>r.src);H(e).then(r=>{Array.isArray(r)&&p(r)})}},[a]);const _=s.useCallback(()=>{if(t.current!==null){const e=t.current.currentTime;N(e)}},[N]),q=s.useCallback(()=>{t.current!==null&&te(t.current.duration)},[(F=t.current)==null?void 0:F.duration]),ce=s.useCallback(()=>{a.length!==n&&u(!0)},[a]),z=s.useCallback(()=>u(!1),[u]),le=s.useCallback(()=>u(e=>!e),[u]),E=s.useCallback((e=!1)=>{if(a.length===n)return;let r;if(h){const S=a.map((b,Ce)=>Ce).filter(b=>b!==c);r=S[Math.floor(Math.random()*S.length)],C(b=>(b=b.slice(n,Le),[r,...b]))}else r=c+L;r>=a.length&&(u(e),r=n,!e)||(k(n),i||u(!0),d(r))},[a,c,h,i,d]),B=s.useCallback(()=>{var e;switch(R){case l.PlayAll:E();break;case l.LoopAll:E(!0);break;case l.LoopCue:(e=t.current)==null||e.play();break}},[R,E]),ie=s.useCallback(()=>{if(a.length===n||!t.current)return;if(g>Ie){t.current.currentTime=n;return}let e=n;if(h){if(Q.length===L)return;C(r=>{const[,...y]=r;return e=y[n],y})}else e=c-L;e<n&&(e=a.length-L),d(e),k(n),u(!0)},[a,Q,c,g,U]),fe=e=>d(e),K=e=>{W(e),m.setItem("player-volume",String(e))},de=e=>{const r=Ne(e);K(r)},me=()=>w(!0),pe=()=>w(!1),ge=()=>w(e=>!e),he=()=>D(!0),ye=()=>D(!1),Se=()=>D(e=>!e),Pe=()=>{ae(e=>{let r=l.PlayAll;return e===l.PlayAll&&(r=l.LoopAll),e===l.LoopAll&&(r=l.LoopCue),e===l.LoopCue&&(r=l.PlayAll),m.setItem("player-repeat",String(r)),r})},ve=e=>{T(r=>[...r,e]),oe(e)},xe=e=>{z(),C([n]),k(n),T(e),d(n),ue(e)};s.useEffect(()=>{m.setItem("player-muted",String(x))},[x]);const $=()=>{if(t.current&&t.current.buffered.length>0){const e=t.current.buffered.end(t.current.buffered.length-1);k(e/t.current.duration*100)}};s.useEffect(()=>(t.current&&t.current.addEventListener("ended",B),()=>{var e;(e=t.current)==null||e.removeEventListener("ended",B)}),[B]),s.useEffect(()=>(t.current&&(t.current.muted=x,t.current.volume=v,u(!1),t.current.preload="metadata",t.current.addEventListener("progress",$),t.current.addEventListener("timeupdate",_),t.current.addEventListener("durationchange",q)),()=>{t.current&&(t.current.pause(),t.current.removeEventListener("progress",$),t.current.removeEventListener("timeupdate",_),t.current.removeEventListener("durationchange",q),t.current=null)}),[]);const be={play:ce,pause:z,togglePlayPause:le,next:E,previous:ie,setVolume:K,setVolumePercent:de,mute:me,unmute:pe,toggleMute:ge,shuffleOn:he,shuffleOff:ye,toggleShuffle:Se,toggleLoop:Pe,addToPlaylist:ve,replacePlaylist:xe,setCurrentTrack:fe,setUpdateTime:U,setPlaylistId:M,volume:v,volumePercent:X,bufferedPercentage:Z,currentPlaylistId:A,maxTime:ee,playlist:a,durations:j,isPlaying:i,currentTime:g,currentTrackIndex:c,repeatMode:R,isShuffled:h,isLoading:f,isMuted:x};return o.jsx(je.Provider,{value:be,children:I})},Fe=()=>{const I=Ve(),[f,P]=s.useState(1),[a,{open:T,close:j}]=we(!1),[p,A]=s.useState("preview"),M=u=>{fetch(`tracks_${u}.json`).then(g=>g.json()).then(g=>{I.replacePlaylist(g)})},c=o.jsx(Ke,{size:18});s.useEffect(()=>{M(f)},[f]);const d=s.useCallback(()=>{let u=f+1;u>3&&(u=1),P(u)},[f]),i=s.useCallback(()=>{let u=f-1;u<1&&(u=3),P(u)},[f]);return De([["alt+ArrowLeft",i],["alt+ArrowRight",d],["mod+Slash",T]]),o.jsx(Re,{children:o.jsxs(G,{gap:"xs",children:[o.jsxs(G,{children:[o.jsx(Be,{}),o.jsx(Te,{order:2,children:"No Sync Demo"})]}),o.jsx(He,{opened:a,close:j}),p==="preview"?o.jsx(Ue,{nextPlaylist:d,prevPlaylist:i}):o.jsx(Oe,{code:[{fileName:"main.tsx",code:Qe,language:"tsx",icon:c},{fileName:"App.tsx",code:_e,language:"tsx",icon:c}]}),o.jsx(qe,{value:p,onChange:A}),o.jsx(ze,{})]})})},We=()=>o.jsx($e,{children:o.jsx(Fe,{})});export{We as default};
