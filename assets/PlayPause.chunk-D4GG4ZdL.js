import{r as s,j as o,T as Te}from"./index-BCMco0VL.js";import{u as Ie,f as a,d as Ae,L as i,t as je,s as I,o as Me,P as we,b as Ve,c as De,a as J,p as Ne,e as Be,g as Re,h as He,i as Ue,S as W,B as _e,H as qe,j as Ge,C as Oe,q as Qe,l as Ye,m as ze,n as Ke,T as $e}from"./Layout-DUmgL2IH.js";const p=window.localStorage,Je=({children:A})=>{var $;const[m,P]=Ie(void 0,Ve),[u,E]=s.useState([]),[j,S]=s.useState([]),[M,w]=s.useState(""),[c,d]=s.useState(a),[l,n]=s.useState(!1),[g,H]=s.useState(a),[V,U]=s.useState(0),_=p.getItem("player-volume"),X=_?Number(_):De,[v,Z]=s.useState(X),[F,ee]=s.useState(Ae),[te,L]=s.useState(a),[se,re]=s.useState(a),ne=p.getItem("player-muted")==="true",[x,D]=s.useState(ne),ae=p.getItem("player-shuffle")==="true",[h,N]=s.useState(ae),ue=p.getItem("player-repeat"),[B,ce]=s.useState(Number(ue)||i.PlayAll),[q,k]=s.useState([]),t=s.useRef(new Audio),b=s.useRef(null),oe=s.useCallback((e,r)=>{b.current&&b.current.postMessage({type:e,value:r})},[b.current]);s.useEffect(()=>{l&&k(h?e=>[c,...e]:[]),p.setItem("player-shuffle",String(h))},[h]),s.useEffect(()=>{const e=Math.round(v*100);ee(e)},[v]),s.useEffect(()=>{t.current!==null&&(t.current.currentTime=V,H(V))},[V]),s.useEffect(()=>{if(t.current&&u.length>a){const e=u[c];t.current.src=e==null?void 0:e.src,t.current.currentTime=a}},[u,c]),s.useEffect(()=>{t.current&&u.length>a&&(l?(oe("PAUSE_PLAYING"),P(!0),t.current.play().then(()=>{P(void 0)}).catch(()=>{P(void 0)})):t.current.pause())},[c,u,l]),s.useEffect(()=>{t.current&&(t.current.volume=v,t.current.muted=x)},[v,x]);const le=e=>{const r=Array(e.length).fill(0);if(S(r),e.length>0){const f=e.map(y=>y.src);J(f).then(y=>{Array.isArray(y)&&S(y)})}},ie=e=>{J([e.src]).then(r=>{r&&S(f=>[...f,r[0]])})},G=s.useCallback(()=>{t.current!==null&&re(t.current.duration)},[($=t.current)==null?void 0:$.duration]),O=s.useCallback(()=>{u.length!==a&&n(!0)},[u]),Q=s.useCallback(()=>n(!1),[n]),de=s.useCallback(()=>n(e=>!e),[n]),T=s.useCallback((e=!1)=>{if(u.length===a)return;let r;if(h){const y=u.map((C,Le)=>Le).filter(C=>C!==c);r=y[Math.floor(Math.random()*y.length)],k(C=>(C=C.slice(a,je),[r,...C]))}else r=c+I;r>=u.length&&(n(e),r=a,!e)||(L(a),l||n(!0),d(r))},[u,c,h,l,d]),R=s.useCallback(()=>{var e;switch(B){case i.PlayAll:T();break;case i.LoopAll:T(!0);break;case i.LoopCue:(e=t.current)==null||e.play();break}},[B,T]),fe=s.useCallback(()=>{if(u.length===a||!t.current)return;if(g>Me){t.current.currentTime=a;return}let e=a;if(h){if(q.length===I)return;k(r=>{const[,...f]=r;return e=f[a],f})}else e=c-I;e<a&&(e=u.length-I),d(e),L(a),n(!0)},[u,q,c,g,U]),me=e=>d(e),Y=e=>{Z(e),p.setItem("player-volume",String(e))},pe=e=>{const r=Ne(e);Y(r)},ge=()=>D(!0),he=()=>D(!1),ye=()=>D(e=>!e),Pe=()=>N(!0),Se=()=>N(!1),ve=()=>N(e=>!e),xe=()=>{ce(e=>{let r=i.PlayAll;return e===i.PlayAll&&(r=i.LoopAll),e===i.LoopAll&&(r=i.LoopCue),e===i.LoopCue&&(r=i.PlayAll),p.setItem("player-repeat",String(r)),r})},be=e=>{E(r=>[...r,e]),ie(e)},Ce=(e,r)=>{const f=r!==void 0||l;Q(),k([a]),L(a),E(e),le(e),f&&(d(r||a),O())};s.useEffect(()=>{p.setItem("player-muted",String(x))},[x]);const ke=s.useCallback(e=>{const{data:r}=e;switch(r==null?void 0:r.type){case"PAUSE_PLAYING":n(!1);break}},[l,d,n,c]),z=()=>{if(t.current&&t.current.buffered.length>0){const e=t.current.buffered.end(t.current.buffered.length-1);L(e/t.current.duration*100)}},K=()=>{if(t.current!==null){const e=t.current.currentTime;H(e)}};s.useEffect(()=>(t.current&&t.current.addEventListener("ended",R),()=>{var e;(e=t.current)==null||e.removeEventListener("ended",R)}),[R]),s.useEffect(()=>(t.current&&(t.current.muted=x,t.current.volume=v,n(!1),t.current.preload="metadata","BroadcastChannel"in window&&!b.current&&(b.current=new BroadcastChannel("playpause-audio-player"),b.current.onmessage=ke),t.current.addEventListener("progress",z),t.current.addEventListener("timeupdate",K),t.current.addEventListener("durationchange",G)),()=>{t.current&&(t.current.pause(),t.current.removeEventListener("progress",z),t.current.removeEventListener("timeupdate",K),t.current.removeEventListener("durationchange",G),t.current=null)}),[]);const Ee={play:O,pause:Q,togglePlayPause:de,next:T,previous:fe,setVolume:Y,setVolumePercent:pe,mute:ge,unmute:he,toggleMute:ye,shuffleOn:Pe,shuffleOff:Se,toggleShuffle:ve,toggleLoop:xe,addToPlaylist:be,replacePlaylist:Ce,setCurrentTrack:me,setUpdateTime:U,setPlaylistId:w,volume:v,volumePercent:F,bufferedPercentage:te,currentPlaylistId:M,maxTime:se,playlist:u,durations:j,isPlaying:l,currentTime:g,currentTrackIndex:c,repeatMode:B,isShuffled:h,isLoading:m,isMuted:x};return o.jsx(we.Provider,{value:Ee,children:A})},We=()=>{const A=Be(),[m,P]=s.useState(1),[u,{open:E,close:j}]=Re(!1),[S,M]=s.useState("preview"),w=n=>{fetch(`tracks_${n}.json`).then(g=>g.json()).then(g=>{A.replacePlaylist(g)})},c=o.jsx($e,{size:18});s.useEffect(()=>{w(m)},[m]);const d=s.useCallback(()=>{let n=m+1;n>3&&(n=1),P(n)},[m]),l=s.useCallback(()=>{let n=m-1;n<1&&(n=3),P(n)},[m]);return He([["alt+ArrowLeft",l],["alt+ArrowRight",d],["mod+Slash",E]]),o.jsx(Ue,{children:o.jsxs(W,{gap:"xs",children:[o.jsxs(W,{children:[o.jsx(_e,{}),o.jsx(Te,{order:2,children:"Play/Pause Sync Demo"})]}),o.jsx(qe,{opened:u,close:j}),S==="preview"?o.jsx(Ge,{nextPlaylist:d,prevPlaylist:l}):o.jsx(Oe,{code:[{fileName:"main.tsx",code:Qe,language:"tsx",icon:c},{fileName:"App.tsx",code:Ye,language:"tsx",icon:c}]}),o.jsx(ze,{value:S,onChange:M}),o.jsx(Ke,{})]})})},Fe=()=>o.jsx(Je,{children:o.jsx(We,{})});export{Fe as default};
