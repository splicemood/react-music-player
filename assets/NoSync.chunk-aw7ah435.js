import{r as s,j as o,T as Te}from"./index-BzJhg2PK.js";import{u as ke,f as n,d as Ee,L as l,a as H,t as Le,s as L,o as Ie,P as je,b as Ae,c as Me,p as Ne,e as Ve,g as De,h as we,i as Re,S as W,B as Be,H as He,j as Ue,C as Oe,r as Qe,l as _e,m as qe,n as ze,T as Ke}from"./Layout-uuWoNvRl.js";const p=window.localStorage,$e=({children:I})=>{var J;const[d,P]=ke(void 0,Ae),[a,T]=s.useState([]),[j,g]=s.useState([]),[A,M]=s.useState(""),[c,m]=s.useState(n),[i,u]=s.useState(!1),[h,N]=s.useState(n),[V,U]=s.useState(0),O=p.getItem("player-volume"),X=O?Number(O):Me,[v,Y]=s.useState(X),[Z,F]=s.useState(Ee),[ee,k]=s.useState(n),[te,se]=s.useState(n),re=p.getItem("player-muted")==="true",[x,D]=s.useState(re),ne=p.getItem("player-shuffle")==="true",[y,w]=s.useState(ne),ae=p.getItem("player-repeat"),[R,ue]=s.useState(Number(ae)||l.PlayAll),[Q,C]=s.useState([]),t=s.useRef(new Audio);s.useEffect(()=>{i&&C(y?e=>[c,...e]:[]),p.setItem("player-shuffle",String(y))},[y]),s.useEffect(()=>{const e=Math.round(v*100);F(e)},[v]),s.useEffect(()=>{t.current!==null&&(t.current.currentTime=V,N(V))},[V]),s.useEffect(()=>{if(t.current&&a.length>n){const e=a[c];t.current.src=e==null?void 0:e.src,t.current.currentTime=n}},[a,c]),s.useEffect(()=>{t.current&&a.length>n&&(i?(P(!0),t.current.play().then(()=>{P(void 0)}).catch(()=>{P(void 0)})):t.current.pause())},[c,a,i]),s.useEffect(()=>{t.current&&(t.current.volume=v,t.current.muted=x)},[v,x]);const oe=e=>{const r=Array(e.length).fill(0);if(g(r),e.length>0){const f=e.map(S=>S.src);H(f).then(S=>{Array.isArray(S)&&g(S)})}},ce=e=>{H([e.src]).then(r=>{r&&g(f=>[...f,r[0]])})};s.useEffect(()=>{if(a.length>0){const e=a.map(r=>r.src);H(e).then(r=>{Array.isArray(r)&&g(r)})}},[a]);const _=s.useCallback(()=>{if(t.current!==null){const e=t.current.currentTime;N(e)}},[N]),q=s.useCallback(()=>{t.current!==null&&se(t.current.duration)},[(J=t.current)==null?void 0:J.duration]),z=s.useCallback(()=>{a.length!==n&&u(!0)},[a]),K=s.useCallback(()=>u(!1),[u]),le=s.useCallback(()=>u(e=>!e),[u]),E=s.useCallback((e=!1)=>{if(a.length===n)return;let r;if(y){const S=a.map((b,Ce)=>Ce).filter(b=>b!==c);r=S[Math.floor(Math.random()*S.length)],C(b=>(b=b.slice(n,Le),[r,...b]))}else r=c+L;r>=a.length&&(u(e),r=n,!e)||(k(n),i||u(!0),m(r))},[a,c,y,i,m]),B=s.useCallback(()=>{var e;switch(R){case l.PlayAll:E();break;case l.LoopAll:E(!0);break;case l.LoopCue:(e=t.current)==null||e.play();break}},[R,E]),ie=s.useCallback(()=>{if(a.length===n||!t.current)return;if(h>Ie){t.current.currentTime=n;return}let e=n;if(y){if(Q.length===L)return;C(r=>{const[,...f]=r;return e=f[n],f})}else e=c-L;e<n&&(e=a.length-L),m(e),k(n),u(!0)},[a,Q,c,h,U]),fe=e=>m(e),$=e=>{Y(e),p.setItem("player-volume",String(e))},de=e=>{const r=Ne(e);$(r)},me=()=>D(!0),pe=()=>D(!1),ge=()=>D(e=>!e),he=()=>w(!0),ye=()=>w(!1),Se=()=>w(e=>!e),Pe=()=>{ue(e=>{let r=l.PlayAll;return e===l.PlayAll&&(r=l.LoopAll),e===l.LoopAll&&(r=l.LoopCue),e===l.LoopCue&&(r=l.PlayAll),p.setItem("player-repeat",String(r)),r})},ve=e=>{T(r=>[...r,e]),ce(e)},xe=(e,r)=>{const f=r!==void 0||i;K(),C([n]),k(n),T(e),oe(e),f&&(m(r||n),z())};s.useEffect(()=>{p.setItem("player-muted",String(x))},[x]);const G=()=>{if(t.current&&t.current.buffered.length>0){const e=t.current.buffered.end(t.current.buffered.length-1);k(e/t.current.duration*100)}};s.useEffect(()=>(t.current&&t.current.addEventListener("ended",B),()=>{var e;(e=t.current)==null||e.removeEventListener("ended",B)}),[B]),s.useEffect(()=>(t.current&&(t.current.muted=x,t.current.volume=v,u(!1),t.current.preload="metadata",t.current.addEventListener("progress",G),t.current.addEventListener("timeupdate",_),t.current.addEventListener("durationchange",q)),()=>{t.current&&(t.current.pause(),t.current.removeEventListener("progress",G),t.current.removeEventListener("timeupdate",_),t.current.removeEventListener("durationchange",q),t.current=null)}),[]);const be={play:z,pause:K,togglePlayPause:le,next:E,previous:ie,setVolume:$,setVolumePercent:de,mute:me,unmute:pe,toggleMute:ge,shuffleOn:he,shuffleOff:ye,toggleShuffle:Se,toggleLoop:Pe,addToPlaylist:ve,replacePlaylist:xe,setCurrentTrack:fe,setUpdateTime:U,setPlaylistId:M,volume:v,volumePercent:Z,bufferedPercentage:ee,currentPlaylistId:A,maxTime:te,playlist:a,durations:j,isPlaying:i,currentTime:h,currentTrackIndex:c,repeatMode:R,isShuffled:y,isLoading:d,isMuted:x};return o.jsx(je.Provider,{value:be,children:I})},Ge=()=>{const I=Ve(),[d,P]=s.useState(1),[a,{open:T,close:j}]=De(!1),[g,A]=s.useState("preview"),M=u=>{fetch(`tracks_${u}.json`).then(h=>h.json()).then(h=>{I.replacePlaylist(h)})},c=o.jsx(Ke,{size:18});s.useEffect(()=>{M(d)},[d]);const m=s.useCallback(()=>{let u=d+1;u>3&&(u=1),P(u)},[d]),i=s.useCallback(()=>{let u=d-1;u<1&&(u=3),P(u)},[d]);return we([["alt+ArrowLeft",i],["alt+ArrowRight",m],["mod+Slash",T]]),o.jsx(Re,{children:o.jsxs(W,{gap:"xs",children:[o.jsxs(W,{children:[o.jsx(Be,{}),o.jsx(Te,{order:2,children:"No Sync Demo"})]}),o.jsx(He,{opened:a,close:j}),g==="preview"?o.jsx(Ue,{nextPlaylist:m,prevPlaylist:i}):o.jsx(Oe,{code:[{fileName:"main.tsx",code:Qe,language:"tsx",icon:c},{fileName:"App.tsx",code:_e,language:"tsx",icon:c}]}),o.jsx(qe,{value:g,onChange:A}),o.jsx(ze,{})]})})},Xe=()=>o.jsx($e,{children:o.jsx(Ge,{})});export{Xe as default};
