import{r as s,j as o,T as Te}from"./index-B901UW0W.js";import{u as ke,f as n,d as Ee,L as l,a as B,t as Le,s as E,o as Ie,P as je,b as Ae,c as Me,p as Ne,e as Ve,g as De,h as we,i as Re,S as W,B as Be,H as He,j as Ue,C as Oe,r as Qe,l as _e,m as qe,n as ze,T as Ke}from"./Layout-DvTybH9z.js";const p=window.localStorage,$e=({children:L})=>{var G;const[d,S]=ke(void 0,Ae),[a,C]=s.useState([]),[I,h]=s.useState([]),[j,A]=s.useState(""),[c,m]=s.useState(n),[i,u]=s.useState(!1),[g,M]=s.useState(n),[N,H]=s.useState(0),U=p.getItem("player-volume"),X=U?Number(U):Me,[P,Y]=s.useState(X),[Z,F]=s.useState(Ee),[ee,T]=s.useState(n),[te,se]=s.useState(n),re=p.getItem("player-muted")==="true",[v,V]=s.useState(re),ne=p.getItem("player-shuffle")==="true",[y,D]=s.useState(ne),ae=p.getItem("player-repeat"),[w,ue]=s.useState(Number(ae)||l.PlayAll),[O,b]=s.useState([]),t=s.useRef(new Audio);s.useEffect(()=>{i&&b(y?e=>[c,...e]:[]),p.setItem("player-shuffle",String(y))},[y]),s.useEffect(()=>{const e=Math.round(P*100);F(e)},[P]),s.useEffect(()=>{t.current!==null&&(t.current.currentTime=N,M(N))},[N]),s.useEffect(()=>{if(t.current&&a.length>n){const e=a[c];t.current.src=e==null?void 0:e.src,t.current.currentTime=n}},[a,c]),s.useEffect(()=>{t.current&&a.length>n&&(i?(S(!0),t.current.play().then(()=>{S(void 0)}).catch(()=>{S(void 0)})):t.current.pause())},[c,a,i]),s.useEffect(()=>{t.current&&(t.current.volume=P,t.current.muted=v)},[P,v]);const oe=e=>{const r=Array(e.length).fill(0);h(r),e.length>0&&B(e).then(f=>{Array.isArray(f)&&h(f)})},ce=e=>{B([e]).then(r=>{r&&h(f=>[...f,r[0]])})};s.useEffect(()=>{a.length>0&&B(a).then(e=>{Array.isArray(e)&&h(e)})},[a]);const Q=s.useCallback(()=>{if(t.current!==null){const e=t.current.currentTime;M(e)}},[M]),_=s.useCallback(()=>{t.current!==null&&se(t.current.duration)},[(G=t.current)==null?void 0:G.duration]),q=s.useCallback(()=>{a.length!==n&&u(!0)},[a]),z=s.useCallback(()=>u(!1),[u]),le=s.useCallback(()=>u(e=>!e),[u]),k=s.useCallback((e=!1)=>{if(a.length===n)return;let r;if(y){const J=a.map((x,Ce)=>Ce).filter(x=>x!==c);r=J[Math.floor(Math.random()*J.length)],b(x=>(x=x.slice(n,Le),[r,...x]))}else r=c+E;r>=a.length&&(u(e),r=n,!e)||(T(n),i||u(!0),m(r))},[a,c,y,i,m]),R=s.useCallback(()=>{var e;switch(w){case l.PlayAll:k();break;case l.LoopAll:k(!0);break;case l.LoopCue:(e=t.current)==null||e.play();break}},[w,k]),ie=s.useCallback(()=>{if(a.length===n||!t.current)return;if(g>Ie){t.current.currentTime=n;return}let e=n;if(y){if(O.length===E)return;b(r=>{const[,...f]=r;return e=f[n],f})}else e=c-E;e<n&&(e=a.length-E),m(e),T(n),u(!0)},[a,O,c,g,H]),fe=e=>m(e),K=e=>{Y(e),p.setItem("player-volume",String(e))},de=e=>{const r=Ne(e);K(r)},me=()=>V(!0),pe=()=>V(!1),he=()=>V(e=>!e),ge=()=>D(!0),ye=()=>D(!1),Se=()=>D(e=>!e),Pe=()=>{ue(e=>{let r=l.PlayAll;return e===l.PlayAll&&(r=l.LoopAll),e===l.LoopAll&&(r=l.LoopCue),e===l.LoopCue&&(r=l.PlayAll),p.setItem("player-repeat",String(r)),r})},ve=e=>{C(r=>[...r,e]),ce(e)},xe=(e,r)=>{const f=r!==void 0||i;z(),b([n]),T(n),C(e),oe(e),f&&(m(r||n),q())};s.useEffect(()=>{p.setItem("player-muted",String(v))},[v]);const $=()=>{if(t.current&&t.current.buffered.length>0){const e=t.current.buffered.end(t.current.buffered.length-1);T(e/t.current.duration*100)}};s.useEffect(()=>(t.current&&t.current.addEventListener("ended",R),()=>{var e;(e=t.current)==null||e.removeEventListener("ended",R)}),[R]),s.useEffect(()=>(t.current&&(t.current.muted=v,t.current.volume=P,u(!1),t.current.preload="metadata",t.current.addEventListener("progress",$),t.current.addEventListener("timeupdate",Q),t.current.addEventListener("durationchange",_)),()=>{t.current&&(t.current.pause(),t.current.removeEventListener("progress",$),t.current.removeEventListener("timeupdate",Q),t.current.removeEventListener("durationchange",_),t.current=null)}),[]);const be={play:q,pause:z,togglePlayPause:le,next:k,previous:ie,setVolume:K,setVolumePercent:de,mute:me,unmute:pe,toggleMute:he,shuffleOn:ge,shuffleOff:ye,toggleShuffle:Se,toggleLoop:Pe,addToPlaylist:ve,replacePlaylist:xe,setCurrentTrack:fe,setUpdateTime:H,setPlaylistId:A,volume:P,volumePercent:Z,bufferedPercentage:ee,currentPlaylistId:j,maxTime:te,playlist:a,durations:I,isPlaying:i,currentTime:g,currentTrackIndex:c,repeatMode:w,isShuffled:y,isLoading:d,isMuted:v};return o.jsx(je.Provider,{value:be,children:L})},Ge=()=>{const L=Ve(),[d,S]=s.useState(1),[a,{open:C,close:I}]=De(!1),[h,j]=s.useState("preview"),A=u=>{fetch(`tracks_${u}.json`).then(g=>g.json()).then(g=>{L.replacePlaylist(g)})},c=o.jsx(Ke,{size:18});s.useEffect(()=>{A(d)},[d]);const m=s.useCallback(()=>{let u=d+1;u>3&&(u=1),S(u)},[d]),i=s.useCallback(()=>{let u=d-1;u<1&&(u=3),S(u)},[d]);return we([["alt+ArrowLeft",i],["alt+ArrowRight",m],["mod+Slash",C]]),o.jsx(Re,{children:o.jsxs(W,{gap:"xs",children:[o.jsxs(W,{children:[o.jsx(Be,{}),o.jsx(Te,{order:2,children:"No Sync Demo"})]}),o.jsx(He,{opened:a,close:I}),h==="preview"?o.jsx(Ue,{nextPlaylist:m,prevPlaylist:i}):o.jsx(Oe,{code:[{fileName:"main.tsx",code:Qe,language:"tsx",icon:c},{fileName:"App.tsx",code:_e,language:"tsx",icon:c}]}),o.jsx(qe,{value:h,onChange:j}),o.jsx(ze,{})]})})},Xe=()=>o.jsx($e,{children:o.jsx(Ge,{})});export{Xe as default};
