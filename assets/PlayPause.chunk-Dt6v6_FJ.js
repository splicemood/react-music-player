import{r as s,j as o,T as Te}from"./index-B901UW0W.js";import{u as Ie,f as a,d as Ae,L as i,t as je,s as T,o as Me,P as we,b as Ve,c as De,a as J,p as Ne,e as Be,g as Re,h as He,i as Ue,S as W,B as _e,H as qe,j as Ge,C as Oe,q as Qe,l as Ye,m as ze,n as Ke,T as $e}from"./Layout-DvTybH9z.js";const p=window.localStorage,Je=({children:I})=>{var K;const[m,y]=Ie(void 0,Ve),[u,k]=s.useState([]),[A,P]=s.useState([]),[j,M]=s.useState(""),[c,f]=s.useState(a),[l,n]=s.useState(!1),[h,R]=s.useState(a),[w,H]=s.useState(0),U=p.getItem("player-volume"),X=U?Number(U):De,[S,Z]=s.useState(X),[F,ee]=s.useState(Ae),[te,E]=s.useState(a),[se,re]=s.useState(a),ne=p.getItem("player-muted")==="true",[v,V]=s.useState(ne),ae=p.getItem("player-shuffle")==="true",[g,D]=s.useState(ae),ue=p.getItem("player-repeat"),[N,ce]=s.useState(Number(ue)||i.PlayAll),[_,C]=s.useState([]),t=s.useRef(new Audio),x=s.useRef(null),oe=s.useCallback((e,r)=>{x.current&&x.current.postMessage({type:e,value:r})},[x.current]);s.useEffect(()=>{l&&C(g?e=>[c,...e]:[]),p.setItem("player-shuffle",String(g))},[g]),s.useEffect(()=>{const e=Math.round(S*100);ee(e)},[S]),s.useEffect(()=>{t.current!==null&&(t.current.currentTime=w,R(w))},[w]),s.useEffect(()=>{if(t.current&&u.length>a){const e=u[c];t.current.src=e==null?void 0:e.src,t.current.currentTime=a}},[u,c]),s.useEffect(()=>{t.current&&u.length>a&&(l?(oe("PAUSE_PLAYING"),y(!0),t.current.play().then(()=>{y(void 0)}).catch(()=>{y(void 0)})):t.current.pause())},[c,u,l]),s.useEffect(()=>{t.current&&(t.current.volume=S,t.current.muted=v)},[S,v]);const le=e=>{const r=Array(e.length).fill(0);P(r),e.length>0&&J(e).then(d=>{Array.isArray(d)&&P(d)})},ie=e=>{J([e]).then(r=>{r&&P(d=>[...d,r[0]])})},q=s.useCallback(()=>{t.current!==null&&re(t.current.duration)},[(K=t.current)==null?void 0:K.duration]),G=s.useCallback(()=>{u.length!==a&&n(!0)},[u]),O=s.useCallback(()=>n(!1),[n]),de=s.useCallback(()=>n(e=>!e),[n]),L=s.useCallback((e=!1)=>{if(u.length===a)return;let r;if(g){const $=u.map((b,Le)=>Le).filter(b=>b!==c);r=$[Math.floor(Math.random()*$.length)],C(b=>(b=b.slice(a,je),[r,...b]))}else r=c+T;r>=u.length&&(n(e),r=a,!e)||(E(a),l||n(!0),f(r))},[u,c,g,l,f]),B=s.useCallback(()=>{var e;switch(N){case i.PlayAll:L();break;case i.LoopAll:L(!0);break;case i.LoopCue:(e=t.current)==null||e.play();break}},[N,L]),fe=s.useCallback(()=>{if(u.length===a||!t.current)return;if(h>Me){t.current.currentTime=a;return}let e=a;if(g){if(_.length===T)return;C(r=>{const[,...d]=r;return e=d[a],d})}else e=c-T;e<a&&(e=u.length-T),f(e),E(a),n(!0)},[u,_,c,h,H]),me=e=>f(e),Q=e=>{Z(e),p.setItem("player-volume",String(e))},pe=e=>{const r=Ne(e);Q(r)},he=()=>V(!0),ge=()=>V(!1),ye=()=>V(e=>!e),Pe=()=>D(!0),Se=()=>D(!1),ve=()=>D(e=>!e),xe=()=>{ce(e=>{let r=i.PlayAll;return e===i.PlayAll&&(r=i.LoopAll),e===i.LoopAll&&(r=i.LoopCue),e===i.LoopCue&&(r=i.PlayAll),p.setItem("player-repeat",String(r)),r})},be=e=>{k(r=>[...r,e]),ie(e)},Ce=(e,r)=>{const d=r!==void 0||l;O(),C([a]),E(a),k(e),le(e),d&&(f(r||a),G())};s.useEffect(()=>{p.setItem("player-muted",String(v))},[v]);const ke=s.useCallback(e=>{const{data:r}=e;switch(r==null?void 0:r.type){case"PAUSE_PLAYING":n(!1);break}},[l,f,n,c]),Y=()=>{if(t.current&&t.current.buffered.length>0){const e=t.current.buffered.end(t.current.buffered.length-1);E(e/t.current.duration*100)}},z=()=>{if(t.current!==null){const e=t.current.currentTime;R(e)}};s.useEffect(()=>(t.current&&t.current.addEventListener("ended",B),()=>{var e;(e=t.current)==null||e.removeEventListener("ended",B)}),[B]),s.useEffect(()=>(t.current&&(t.current.muted=v,t.current.volume=S,n(!1),t.current.preload="metadata","BroadcastChannel"in window&&!x.current&&(x.current=new BroadcastChannel("playpause-audio-player"),x.current.onmessage=ke),t.current.addEventListener("progress",Y),t.current.addEventListener("timeupdate",z),t.current.addEventListener("durationchange",q)),()=>{t.current&&(t.current.pause(),t.current.removeEventListener("progress",Y),t.current.removeEventListener("timeupdate",z),t.current.removeEventListener("durationchange",q),t.current=null)}),[]);const Ee={play:G,pause:O,togglePlayPause:de,next:L,previous:fe,setVolume:Q,setVolumePercent:pe,mute:he,unmute:ge,toggleMute:ye,shuffleOn:Pe,shuffleOff:Se,toggleShuffle:ve,toggleLoop:xe,addToPlaylist:be,replacePlaylist:Ce,setCurrentTrack:me,setUpdateTime:H,setPlaylistId:M,volume:S,volumePercent:F,bufferedPercentage:te,currentPlaylistId:j,maxTime:se,playlist:u,durations:A,isPlaying:l,currentTime:h,currentTrackIndex:c,repeatMode:N,isShuffled:g,isLoading:m,isMuted:v};return o.jsx(we.Provider,{value:Ee,children:I})},We=()=>{const I=Be(),[m,y]=s.useState(1),[u,{open:k,close:A}]=Re(!1),[P,j]=s.useState("preview"),M=n=>{fetch(`tracks_${n}.json`).then(h=>h.json()).then(h=>{I.replacePlaylist(h)})},c=o.jsx($e,{size:18});s.useEffect(()=>{M(m)},[m]);const f=s.useCallback(()=>{let n=m+1;n>3&&(n=1),y(n)},[m]),l=s.useCallback(()=>{let n=m-1;n<1&&(n=3),y(n)},[m]);return He([["alt+ArrowLeft",l],["alt+ArrowRight",f],["mod+Slash",k]]),o.jsx(Ue,{children:o.jsxs(W,{gap:"xs",children:[o.jsxs(W,{children:[o.jsx(_e,{}),o.jsx(Te,{order:2,children:"Play/Pause Sync Demo"})]}),o.jsx(qe,{opened:u,close:A}),P==="preview"?o.jsx(Ge,{nextPlaylist:f,prevPlaylist:l}):o.jsx(Oe,{code:[{fileName:"main.tsx",code:Qe,language:"tsx",icon:c},{fileName:"App.tsx",code:Ye,language:"tsx",icon:c}]}),o.jsx(ze,{value:P,onChange:j}),o.jsx(Ke,{})]})})},Fe=()=>o.jsx(Je,{children:o.jsx(We,{})});export{Fe as default};
